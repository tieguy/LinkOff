// ==UserScript==
// @name         LinkOff
// @namespace    https://github.com/njelich/LinkOff
// @version      1.10.0
// @description  Filter and customize your LinkedIn feed - hide promoted posts, suggestions, reactions, and more
// @author       Noah Jelich
// @match        https://www.linkedin.com/*
// @match        https://linkedin.com/*
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_registerMenuCommand
// @run-at       document-idle
// @homepageURL  https://github.com/njelich/LinkOff
// @supportURL   https://github.com/njelich/LinkOff/issues
// @license      MIT
// ==/UserScript==


!function(){"use strict";const e={FEED_POST_ACTIVITY:'[data-id*="urn:li:activity"]',FEED_POST_AGGREGATE:'[data-id*="urn:li:aggregate"]',JOB_POST_ID:"[data-job-id]",JOB_POST_OCCLUDABLE:"[data-occludable-job-id]",JOB_LIST_ITEM:".discovery-templates-vertical-list__list-item",FEED_POLL:"poll",FEED_VIDEO_VJS:'id="vjs_video_',FEED_VIDEO_COMPONENTS:"update-components-linkedin-video",FEED_VIDEO_SHARED:"feed-shared-linkedin-video",FEED_LINK:"https://lnkd.in/",FEED_IMAGE:'class="update-components-image__image-link',FEED_SHARED_POST:"feed-shared-mini-update-v2",FEED_CAROUSEL:"iframe",FEED_COMPANY_LINK:'href="https://www.linkedin.com/company/',FEED_PERSON_LINK:'href="https://www.linkedin.com/in/',FEED_TEXT_PROMOTED:"Promoted",FEED_TEXT_SUGGESTED:"Suggested",FEED_TEXT_FOLLOWING:"following",FEED_TEXT_LIKES_THIS:"likes this",FEED_TEXT_LIKE_THIS:"like this",FEED_TEXT_LOVES_THIS:"loves this",FEED_TEXT_INSIGHTFUL:"finds this insightful",FEED_TEXT_CELEBRATES:"celebrates this",FEED_TEXT_CURIOUS:"is curious about this",FEED_TEXT_SUPPORTS:"supports this",FEED_TEXT_FUNNY:"finds this funny",FEED_TEXT_COMMENTED:"commented on this",FEED_CONTAINER:"scaffold-finite-scroll__content",FEED_SORT_DROPDOWN_TRIGGER:"button.full-width.artdeco-dropdown__trigger.artdeco-dropdown__trigger--placement-bottom",FEED_SORT_RECENT_OPTION:"ul > li:nth-child(2) > div.artdeco-dropdown__item.artdeco-dropdown__item--is-dropdown",JOBS_GUIDANCE:"artdeco-card mb2 pt5",JOBS_AI_BUTTON:"ember-view link-without-hover-state artdeco-button",MISC_LEARNING_TOP:"learning-top-courses",MISC_LEARNING_RECOMMENDATIONS:"pv-course-recommendations",MISC_AD_BANNER_CONTAINER:"ad-banner-container",MISC_ADS_CONTAINER:"ads-container",MISC_AD_BANNER:"ad-banner",MISC_AD_RAIL:"pv-right-rail__sticky-ad-banner",MISC_COMMUNITY_PANEL:"community-panel",MISC_FOLLOW_MODULE:"feed-follows-module",MISC_ACCOUNT_BUILDING_1:"artdeco-card ember-view mt2",MISC_ACCOUNT_BUILDING_2:"artdeco-card mb4 overflow-hidden ember-view",MISC_NETWORK_ABI:"mn-abi-form",MISC_NETWORK_PYMK:"pv-profile-pymk__container artdeco-card",MISC_PREMIUM_UPSELL_LINK:"premium-upsell-link",MISC_PREMIUM_PROMO_CARD:"gp-promo-embedded-card-three__card",MISC_PREMIUM_CARD_PH1:"artdeco-card overflow-hidden ph1 mb2",MISC_PREMIUM_ACCENT_BAR:"artdeco-card premium-accent-bar",MISC_PREMIUM_UPSELL_CONTAINER:"pvs-premium-upsell__container",MISC_PREMIUM_BLURRED:"pvs-entity--blurred",MISC_PREMIUM_TAB:"artdeco-tab ember-view",MISC_NEWS_MODULE:"news-module",MISC_NEWS_WITH_GAME:"news-module--with-game",MISC_NOTIFICATION_COUNT:"notification-badge__count",MISC_PROFILE_COUNTER_CHILD:"entity-list-wrapper",MISC_PROFILE_COUNTER_PARENT:".artdeco-card",UNFOLLOW_BUTTON:'button[aria-label^="Click to stop"]',MESSAGES_LIST:".msg-conversations-container__conversations-list",MESSAGES_DROPDOWN:".msg-conversations-container__dropdown-container",MESSAGES_DROPDOWN_INNER:".msg-conversations-container__dropdown-container > div",MESSAGES_TITLE_BUTTON:".msg-conversations-container__title-row button.artdeco-dropdown__trigger"},t=[e.FEED_POST_ACTIVITY,e.FEED_POST_AGGREGATE],o=[e.JOB_POST_ID,e.JOB_POST_OCCLUDABLE,e.JOB_LIST_ITEM],n="[data-hidden=false]",a="h •",s="d •",i="w •",d="mo •",r="y •",l=(e,t=void 0)=>{const o=(t??document).querySelectorAll(e);return!(o.length>0)||Array.from(o).some(e=>e.innerHTML.includes("skeleton"))},c=e=>{const t=document.getElementsByClassName(e);return!(t.length>0)||Array.from(t).some(e=>e.innerHTML.includes("skeleton"))},f=async e=>{for(;c(e);)await new Promise(e=>{requestAnimationFrame(e)});return document.getElementsByClassName(e)},m=(e,t)=>{let o=0;const n=setInterval(()=>{e()||o>=10?clearInterval(n):(t(),o+=1)},350)},_=async(e,t,o=!0)=>{const n=await f(e);for(let e of n)e.classList.remove("hide","dim","showIcon"),e.classList.add(t),o&&e.classList.add("showIcon"),m(()=>e.classList.contains(t),()=>{e.classList.remove("hide","dim","showIcon"),e.classList.add(t),o&&e.classList.add("showIcon")})},E=async e=>{const t=await f(e);for(let e of t)e.classList.remove("hide","dim","showIcon")},h=(e,t)=>{let o=[];switch(t){case"all":o=e;break;case"blocked":o=e.map(e=>`${e}[data-hidden=true]`);break;case"shown":o=e.map(e=>`${e}${n}`);break;case"pristine":o=e.map(e=>`${e}${n},${e}:not([data-hidden])`)}return o.join(",")},g=()=>{console.log("LinkOff: Reset shown posts"),document.querySelectorAll(h(t,"shown")).forEach(e=>{e.classList.remove("hide","dim","showIcon"),delete e.dataset.hidden})},u=()=>{console.log("LinkOff: Resetting blocked posts"),document.querySelectorAll(h(t,"blocked")).forEach(e=>{e.classList.remove("hide","dim","showIcon"),delete e.dataset.hidden})},I=()=>{console.log("LinkOff: Reset shown jobs"),document.querySelectorAll(h(o,"all")).forEach(e=>{e.classList.remove("hide","dim","showIcon"),delete e.dataset.hidden})},p=async()=>{console.log("LinkOff: Waiting for Messages to load");const t=e.MESSAGES_DROPDOWN.replace(/^\./,"");await f(t);const o=document.querySelector(e.MESSAGES_DROPDOWN_INNER),n=new MutationObserver(function(){const t=o.querySelector("ul");if(!t)return;const n=document.createElement("div");n.classList.add("artdeco-dropdown__item","artdeco-dropdown__item--is-dropdown","ember-view"),n.textContent="Select all for deletion (LinkOff)",n.onclick=function(){document.querySelector(e.MESSAGES_TITLE_BUTTON).click(),(async()=>{const t=document.querySelector(e.MESSAGES_LIST);if(!t)return void alert("No messages. Are you on the messaging page?\n\nIf not, please navigate to messaging using the LinkedIn navbar and then click the Select Messages for Deletion button again.");await async function(){return await new Promise(e=>{let o=0,n=0;if(t){const a=setInterval(()=>{const{scrollHeight:s}=t;s>2e4&&(clearInterval(a),e()),s===o&&(n>=3?(clearInterval(a),e()):n++),o=s,t.scrollTop=s},1e3)}else alert("The page took too long to load. Please try again.")})}();const o=t.getElementsByTagName("label");for(let e=0;e<o.length;e++)o[e]&&o[e].click();alert("Click the trash can icon at the top to delete all messages.")})()},console.log('LinkOff: Adding "Select messages for deletion" button'),t.appendChild(n)});n.observe(o,{attributes:!1,childList:!0,subtree:!1,characterData:!1})},b=":root{--black:#000;--black-a90:rgba(0,0,0,0.9);--black-a75:rgba(0,0,0,0.75);--black-a60:rgba(0,0,0,0.6);--black-a45:rgba(0,0,0,0.45);--black-a30:rgba(0,0,0,0.3);--black-a15:rgba(0,0,0,0.15);--black-a12:rgba(0,0,0,0.12);--black-a08:rgba(0,0,0,0.08);--black-a04:rgba(0,0,0,0.04);--white:#fff;--white-a90:hsla(0,0%,100%,0.9);--white-a85:hsla(0,0%,100%,0.85);--white-a70:hsla(0,0%,100%,0.7);--white-a55:hsla(0,0%,100%,0.55);--white-a40:hsla(0,0%,100%,0.4);--white-a25:hsla(0,0%,100%,0.25);--white-a18:hsla(0,0%,100%,0.18);--white-a12:hsla(0,0%,100%,0.12);--white-a06:hsla(0,0%,100%,0.06);--blue-10:#f6fbff;--blue-20:#e8f3ff;--blue-30:#d0e8ff;--blue-40:#a8d4ff;--blue-50:#70b5f9;--blue-50-a20:rgba(112,181,249,0.2);--blue-50-a30:rgba(112,181,249,0.3);--blue-60:#378fe9;--blue-70:#0a66c2;--blue-80:#004182;--blue-90:#09223b;--cool-gray-10:#f9fafb;--cool-gray-20:#eef3f8;--cool-gray-30:#dce6f1;--cool-gray-40:#c0d1e2;--cool-gray-50:#9db3c8;--cool-gray-60:#788fa5;--cool-gray-70:#56687a;--cool-gray-80:#38434f;--cool-gray-90:#1d2226;--warm-gray-10:#fafaf9;--warm-gray-20:#f3f2ef;--warm-gray-30:#e9e5df;--warm-gray-40:#d6cec2;--warm-gray-50:#b9af9f;--warm-gray-60:#958b7b;--warm-gray-70:#6e6558;--warm-gray-80:#474139;--warm-gray-90:#211f1c;--warm-red-10:#fff9f7;--warm-red-20:#ffefea;--warm-red-30:#ffded5;--warm-red-40:#fdc2b1;--warm-red-50:#f5987e;--warm-red-60:#e16745;--warm-red-70:#b24020;--warm-red-80:#762812;--warm-red-90:#351a12;--teal-10:#eefdff;--teal-20:#d5f9fe;--teal-30:#aef0fa;--teal-40:#79deee;--teal-50:#44bfd3;--teal-50-a30:rgba(68,191,211,0.3);--teal-60:#2199ac;--teal-70:#13707e;--teal-80:#104952;--teal-90:#0e2428;--purple-10:#fcf9ff;--purple-20:#f7efff;--purple-30:#eedfff;--purple-40:#dec5fd;--purple-40-a15:rgba(222,197,253,0.15);--purple-50:#c79ef7;--purple-60:#a872e8;--purple-70:#8344cc;--purple-70-a15:rgba(131,68,204,0.15);--purple-80:#592099;--purple-90:#2c1349;--system-red-10:#fff9f9;--system-red-20:#ffeeef;--system-red-30:#ffddde;--system-red-40:#ffbfc1;--system-red-50:#fc9295;--system-red-60:#f55257;--system-red-70:#cc1016;--system-red-80:#8a0005;--system-red-90:#46080a;--system-green-10:#f0fdf7;--system-green-20:#dbf9eb;--system-green-30:#b6f2d6;--system-green-40:#7ce3b3;--system-green-50:#3ec786;--system-green-60:#13a05f;--system-green-70:#057642;--system-green-80:#004d2a;--system-green-90:#022716;--pink-10:#fff8ff;--pink-20:#ffedfe;--pink-30:#ffdafd;--pink-40:#fcb9f9;--pink-50:#f489ee;--pink-60:#dd51d6;--pink-70:#b11faa;--pink-80:#770c72;--pink-90:#3d0a3b;--amber-10:#fdfaf5;--amber-20:#fbf1e2;--amber-30:#fce2ba;--amber-40:#f8c77e;--amber-50:#e7a33e;--amber-60:#c37d16;--amber-70:#915907;--amber-80:#5d3b09;--amber-90:#2a1f0e;--copper-10:#fcfaf9;--copper-20:#fcf0ed;--copper-30:#fadfd8;--copper-40:#f2c5b8;--copper-50:#e0a191;--copper-60:#be7b6a;--copper-70:#8f5849;--copper-80:#5d392f;--copper-90:#2d1d19;--green-10:#f6fcf4;--green-20:#e3f9d8;--green-30:#c7f1b2;--green-40:#a5df89;--green-50:#7fc15e;--green-60:#5f9b41;--green-70:#44712e;--green-80:#2f4922;--green-90:#1b2416;--sage-10:#f8fbf6;--sage-20:#eaf6e4;--sage-30:#d7ebce;--sage-40:#bdd7b0;--sage-50:#9db88f;--sage-60:#7b9370;--sage-70:#5a6b51;--sage-80:#3a4535;--sage-90:#1e221c;--lime-10:#f9fce9;--lime-20:#eff8b9;--lime-30:#dfee89;--lime-40:#c6d957;--lime-50:#a6ba32;--lime-60:#83941f;--lime-70:#5f6c16;--lime-80:#3e4613;--lime-90:#20230f;--camo-10:#fafbf3;--camo-20:#f1f4e4;--camo-30:#e4e8cc;--camo-40:#cdd3ac;--camo-50:#aeb48a;--camo-60:#8a8f6c;--camo-70:#65684e;--camo-80:#414335;--camo-90:#21211d;--smoke-10:#f8fafb;--smoke-20:#edf3f4;--smoke-30:#dbe7e9;--smoke-40:#bfd3d6;--smoke-50:#a0b4b7;--smoke-60:#7d8f92;--smoke-70:#5b696b;--smoke-80:#3c4345;--smoke-90:#1f2122;--lavender-10:#fbf9fd;--lavender-20:#f4f1f9;--lavender-30:#eae2f3;--lavender-40:#d7cae7;--lavender-50:#bba9d1;--lavender-60:#9983b1;--lavender-70:#715e86;--lavender-80:#493d57;--lavender-90:#241f29;--mauve-10:#fcf9fc;--mauve-20:#f9eff8;--mauve-30:#f2e0f1;--mauve-40:#e5c6e3;--mauve-50:#cea2cc;--mauve-60:#ac7da9;--mauve-70:#80597e;--mauve-80:#523a51;--mauve-90:#271e27;--system-gray-10:#fafafa;--system-gray-20:#f2f2f2;--system-gray-30:#e5e5e5;--system-gray-40:#cfcfcf;--system-gray-50:#b0b0b0;--system-gray-60:#8c8c8c;--system-gray-70:#666;--system-gray-80:#424242;--system-gray-90:#212121;--system-orange-10:#fff9f6;--system-orange-20:#ffefe8;--system-orange-30:#ffdfd1;--system-orange-40:#ffc1a7;--system-orange-50:#ff9466;--system-orange-60:#eb6126;--system-orange-70:#b93a04;--system-orange-80:#792603;--system-orange-90:#351a0f;--transparent:transparent;--transparent-white:hsla(0,0%,100%,0);",w=()=>{const e=document.createElement("style"),t=e=>{return(parseInt(e)+(t=220,o=255,Math.floor(Math.random()*(o-t)+t)))%256;var t,o};e.innerHTML=b.replace(/100%|0%/g,e=>"100%"==e?"0%":"100%").replace(/#000|#fff/g,e=>"#fff"==e?"#000":"#fff").replace(/#([fe])(.)([fe])(.)([fe])(.)/g,"#1$21$41$6").replace(/\d+(?=,)/g,e=>t(e)),e.innerHTML+="--color-background-brand-accent-4: var(--cool-gray-90);",document.body.appendChild(e)};let O;const S=e=>{e("dark-mode",!0)?w():(()=>{const e=document.createElement("style");e.innerHTML=b,document.body.appendChild(e)})()},T=e=>{e("wide-mode",!0)?(O=document.getElementsByClassName("scaffold-layout__inner scaffold-layout-container scaffold-layout-container--reflow")[0]||O,O&&O.classList.add("wide-mode")):O&&O.classList.remove("wide-mode")};let M,C=0,y=!1,L=[],N=[];const k=(e,t)=>{const o=t=>{if(t)for(let t=2;t<=30;t++)e.push(`text::${t}${s}`);else e.push(`text::${s}`);n(!1)},n=t=>{if(t)for(let t=2;t<=4;t++)e.push(`text::${t}${i}`);else e.push(`text::${i}`);l(!1)},l=t=>{if(t)for(let t=2;t<=12;t++)e.push(`text::${t}${d}`);else e.push(`text::${d}`);c(!1)},c=t=>{if(t)for(let t=2;t<=5;t++)e.push(`text::${t}${r}`);else e.push(`text::${r}`)};switch(t){case"hour":((t=!0)=>{if(t)for(let t=2;t<=24;t++)e.push(`text::${t}${a}`);else e.push(`text::${a}`);o(!1)})(e);break;case"day":o(e);break;case"week":n(e);break;case"month":l(e);break;case"year":c(e)}},R=async t=>{let o=0,n=!1,a=e.FEED_CONTAINER;if("https://www.linkedin.com/feed/"==window.location.href)for(;!n&&o<50;)await new Promise(e=>{setTimeout(()=>{t?(document.getElementsByClassName(a).item(0).classList.remove("hide"),console.log("LinkOff: feed enabled")):(document.getElementsByClassName(a).item(0).classList.add("hide"),console.log("LinkOff: feed disabled")),n=!0,o+=1,e()},100+10*o)})},A=async()=>{if("https://www.linkedin.com/feed/"!==window.location.href&&"https://www.linkedin.com/"!==window.location.href)return;const t=await(async e=>{for(;l(e);)await new Promise(e=>{requestAnimationFrame(e)});return document.querySelector(e)})(e.FEED_SORT_DROPDOWN_TRIGGER),o=t.parentElement;t.click();(await(async(e,t)=>{for(;l(`:scope ${e}`,t);)await new Promise(e=>{requestAnimationFrame(e)});return t.querySelector(`:scope ${e}`)})(e.FEED_SORT_RECENT_OPTION,o)).click()},D=(e,o)=>{R(!0),u(),clearInterval(M),((e,o,n)=>{let a;N.some(t=>!e.includes(t))&&g(),N=e,e.length&&(M=setInterval(()=>{C%10==0&&u(),a=document.querySelectorAll(h(t,"pristine")),console.log(`LinkOff: Found ${a.length} unblocked posts`),a.length>5||"dim"==o?a.forEach(t=>{let n;e.some((e,o)=>{n=o;const a=e.split("::");return a.length>1?-1!==t.innerText.indexOf(a[1]):-1!==t.innerHTML.indexOf(a[0])})?(((e,t)=>{e.classList.add(t,"showIcon"),e.onclick=()=>{e.classList.remove("hide","dim","showIcon"),e.dataset.hidden="shown"},e.dataset.hidden=!0})(t,o),console.log(`LinkOff: Blocked post ${t.getAttribute("data-id")} for keyword ${e[n]}`)):(t.classList.remove("hide","dim","showIcon"),t.dataset.hidden=!1)}):y||n||(y=!0,alert("Scroll down to start blocking posts (LinkedIn needs at least 10 loaded to load new ones).\n\nTo disable this alert, toggle it under misc in LinkOff settings")),C++},350))})(L,e,o["disable-postcount-prompt"])};function v(t,o,n,a){if(t("main-toggle",!1))return R(!0),clearInterval(M),u(),void g();o&&(t("sort-by-recent",!0)&&A(),L=(t=>{let o=""==t["feed-keywords"]?[]:t["feed-keywords"].split(",");const n=t["hide-by-age"];return"disabled"!==n&&k(o,n),t["hide-polls"]&&o.push(e.FEED_POLL),t["hide-videos"]&&o.push(e.FEED_VIDEO_VJS,e.FEED_VIDEO_COMPONENTS,e.FEED_VIDEO_SHARED),t["hide-links"]&&o.push(e.FEED_LINK),t["hide-images"]&&o.push(e.FEED_IMAGE),t["hide-promoted"]&&o.push(`text::${e.FEED_TEXT_PROMOTED}`),t["hide-shared"]&&o.push(e.FEED_SHARED_POST),t["hide-followed"]&&o.push(`text::${e.FEED_TEXT_FOLLOWING}`),t["hide-liked"]&&o.push(`text::${e.FEED_TEXT_LIKES_THIS}`,`text::${e.FEED_TEXT_LIKE_THIS}`),t["hide-other-reactions"]&&o.push(`text::${e.FEED_TEXT_LOVES_THIS}`,`text::${e.FEED_TEXT_INSIGHTFUL}`,`text::${e.FEED_TEXT_CELEBRATES}`,`text::${e.FEED_TEXT_CURIOUS}`,`text::${e.FEED_TEXT_SUPPORTS}`,`text::${e.FEED_TEXT_FUNNY}`),t["hide-commented-on"]&&o.push(`text::${e.FEED_TEXT_COMMENTED}`),t["hide-by-companies"]&&o.push(e.FEED_COMPANY_LINK),t["hide-by-people"]&&o.push(e.FEED_PERSON_LINK),t["hide-suggested"]&&o.push(`text::${e.FEED_TEXT_SUGGESTED}`),t["hide-carousels"]&&o.push(e.FEED_CAROUSEL),console.log("LinkOff: Current feed keywords are",o),o})(a),t("hide-whole-feed",!0)?(R(!1),u(),clearInterval(M)):L!==N&&D(n,a))}const P=()=>{E(e.MISC_LEARNING_TOP),E(e.MISC_LEARNING_RECOMMENDATIONS)},U=()=>{E(e.MISC_AD_BANNER_CONTAINER),E(e.MISC_ADS_CONTAINER),E(e.MISC_AD_BANNER),E(e.MISC_AD_RAIL)},F=()=>{E(e.MISC_COMMUNITY_PANEL)},B=()=>{E(e.MISC_FOLLOW_MODULE)},H=()=>{E(e.MISC_ACCOUNT_BUILDING_1),E(e.MISC_ACCOUNT_BUILDING_2)},G=()=>{E(e.MISC_NETWORK_ABI),E(e.MISC_NETWORK_PYMK)},$=()=>{E(e.MISC_PREMIUM_UPSELL_LINK),E(e.MISC_PREMIUM_PROMO_CARD),E(e.MISC_PREMIUM_CARD_PH1),E(e.MISC_PREMIUM_ACCENT_BAR),E(e.MISC_PREMIUM_UPSELL_CONTAINER),E(e.MISC_PREMIUM_BLURRED),(async(e,t)=>{const o=(await f(e))[t];o&&o.classList.remove("hide","dim","showIcon")})(e.MISC_PREMIUM_TAB,1)},x=(t,o)=>{t("hide-premium",!0)?(_(e.MISC_PREMIUM_UPSELL_LINK,o,!1),_(e.MISC_PREMIUM_PROMO_CARD,o),_(e.MISC_PREMIUM_CARD_PH1,o,!1),_(e.MISC_PREMIUM_UPSELL_CONTAINER,o,!1),_(e.MISC_PREMIUM_BLURRED,o,!1),_(e.MISC_PREMIUM_ACCENT_BAR,o),(async(e,t,o,n=!0)=>{const a=(await f(e))[t];a&&(a.classList.remove("hide","dim","showIcon"),a.classList.add(o,n&&"showIcon"))})(e.MISC_PREMIUM_TAB,1,o,!1)):$()},W=()=>{E(e.MISC_NEWS_MODULE),E(e.MISC_NEWS_WITH_GAME)},j=()=>{E(e.MISC_NOTIFICATION_COUNT)},K=()=>{(async(e,t)=>{const o=await f(e);for(let e of o)e.closest(t)?.classList.remove("hide","dim","showIcon")})(e.MISC_PROFILE_COUNTER_CHILD,e.MISC_PROFILE_COUNTER_PARENT)},X=(t,o)=>{t("hide-profile-counters",!0)?(async(e,t,o,n=!0)=>{const a=await f(e);for(let e of a){const a=e.closest(t);if(!a)return;a.classList.remove("hide","dim","showIcon"),a.classList.add(o),n&&a.classList.add("showIcon"),m(()=>a.classList.contains(o),()=>{a.classList.remove("hide","dim","showIcon"),a.classList.add(o),n&&a.classList.add("showIcon")})}})(e.MISC_PROFILE_COUNTER_CHILD,e.MISC_PROFILE_COUNTER_PARENT,o,!1):j()};let J;const V=(t,o)=>{((t,o)=>{t("hide-linkedin-learning",!0)?(_(e.MISC_LEARNING_TOP,o),_(e.MISC_LEARNING_RECOMMENDATIONS,o)):P()})(t,o),((t,o)=>{t("hide-community-panel",!0)?_(e.MISC_COMMUNITY_PANEL,o):F()})(t,o),((t,o)=>{t("hide-follow-recommendations",!0)?_(e.MISC_FOLLOW_MODULE,o):B()})(t,o),((t,o)=>{t("hide-account-building",!0)?(_(e.MISC_ACCOUNT_BUILDING_1,o),_(e.MISC_ACCOUNT_BUILDING_2,o)):H()})(t,o),((t,o)=>{t("hide-network-building",!0)?(_(e.MISC_NETWORK_ABI,o),_(e.MISC_NETWORK_PYMK,o)):G()})(t,o),x(t,o),((t,o)=>{t("hide-news",!0)?(_(e.MISC_NEWS_MODULE,o),_(e.MISC_NEWS_WITH_GAME,o)):W()})(t,o),((t,o)=>{t("hide-advertisements",!0)?(_(e.MISC_AD_BANNER_CONTAINER,o),_(e.MISC_ADS_CONTAINER,o),_(e.MISC_AD_BANNER,o),_(e.MISC_AD_RAIL,o)):U()})(t,o),(t=>{t("hide-notification-count",!0)?_(e.MISC_NOTIFICATION_COUNT,"hide",!1):j()})(t),X(t,o)};function q(e,t,o){e("main-toggle",!1)&&(W(),j(),H(),G(),U(),F(),B(),$(),P(),K(),clearInterval(J)),t&&(V(e,o),J&&clearInterval(J),J=setInterval(()=>{V(e,o)},500))}const Y=async()=>{let t=document.querySelectorAll(e.UNFOLLOW_BUTTON)||[];t.length||console.log("LinkOff: Successfully unfollowed all");for(let e of t)window.scrollTo(0,e.offsetTop-260),e.click(),await new Promise(e=>setTimeout(e,100));window.scrollTo(0,document.body.scrollHeight),await new Promise(e=>setTimeout(e,1e3)),t=document.querySelectorAll(e.UNFOLLOW_BUTTON)||[],t.length&&Y()};let z,Q=0,Z=[],ee=[];const te=()=>{clearInterval(z),I(),oe(),ne()},oe=()=>{E(e.JOBS_GUIDANCE)},ne=()=>{E(e.JOBS_AI_BUTTON)};function ae(t,n,a,s){t("main-toggle",!1)?te():n&&(Z=(e=>{let t=""==e["job-keywords"]?[]:e["job-keywords"].split(",");return e["hide-promoted-jobs"]&&t.push("Promoted"),console.log("LinkOff: Current job keywords are",t),t})(s),Z===ee&&0!==Z.length||(te(),((e,t)=>{if(!window.location.href.startsWith("https://www.linkedin.com/jobs/"))return;let n;ee.some(t=>!e.includes(t))&&I(),ee=e,e.length&&(z=setInterval(()=>{Q%10==0&&I(),n=document.querySelectorAll(h(o,"all")),console.log(`LinkOff: Found ${n.length} unblocked jobs`),n.forEach(o=>{let n;e.some((e,t)=>(n=t,-1!==o.innerHTML.toLowerCase().indexOf(e.toLowerCase())))?(o.classList.add(t,"showIcon"),console.log(`LinkOff: Blocked job ${o.getAttribute("data-occludable-job-id")} for keyword ${e[n]}`)):o.classList.remove("hide","dim","showIcon")}),Q++},350))})(Z,a)),((t,o)=>{t("hide-job-guidance",!0)?_(e.JOBS_GUIDANCE,o):(t("main-toggle",!1)||t("hide-job-guidance",!1))&&oe()})(t,a),((t,o)=>{t("hide-ai-button",!0)?_(e.JOBS_AI_BUTTON,o,!1):(t("main-toggle",!1)||t("hide-ai-button",!1))&&ne()})(t,a))}const se={"gentle-mode":!0,"dark-mode":!1,"main-toggle":!0,"wide-mode":!1,"hide-whole-feed":!1,"hide-by-age":"week","feed-keywords":"","hide-shared":!1,"hide-videos":!1,"hide-liked":!0,"hide-suggested":!0,"hide-other-reactions":!1,"sort-by-recent":!0,"hide-carousels":!1,"hide-by-companies":!0,"hide-by-people":!1,"hide-commented-on":!1,"hide-followed":!0,"hide-images":!1,"hide-links":!1,"hide-polls":!0,"hide-promoted":!0,"hide-linkedin-learning":!0,"hide-premium":!0,"hide-account-building":!0,"hide-network-building":!0,"hide-advertisements":!0,"hide-follow-recommendations":!0,"hide-news":!1,"hide-notification-count":!1,"hide-profile-counters":!1,"hide-community-panel":!0,"disable-postcount-prompt":!1,"job-keywords":"","hide-job-guidance":!1,"hide-ai-button":!1,"hide-promoted-jobs":!1},ie={"gentle-mode":"Gentle Mode (Dim Instead of Hide)","dark-mode":"Dark Mode","main-toggle":"Enable LinkOff","wide-mode":"Wide Mode","hide-whole-feed":"Hide Entire Feed","hide-by-age":"Hide Posts by Age","feed-keywords":"Feed Keywords","hide-shared":"Hide Shared Posts","hide-videos":"Hide Videos","hide-liked":'Hide "Liked by" Posts',"hide-suggested":"Hide Suggested Posts","hide-other-reactions":"Hide Other Reactions","sort-by-recent":"Sort by Recent","hide-carousels":"Hide Carousels","hide-by-companies":"Hide Company Posts","hide-by-people":"Hide People Posts","hide-commented-on":'Hide "Commented on" Posts',"hide-followed":"Hide Following Posts","hide-images":"Hide Images","hide-links":"Hide Links","hide-polls":"Hide Polls","hide-promoted":"Hide Promoted Posts","hide-linkedin-learning":"Hide LinkedIn Learning","hide-premium":"Hide Premium Upsells","hide-account-building":"Hide Account Building","hide-network-building":"Hide Network Building","hide-advertisements":"Hide Advertisements","hide-follow-recommendations":"Hide Follow Recommendations","hide-news":"Hide News","hide-notification-count":"Hide Notification Count","hide-profile-counters":"Hide Profile Counters","hide-community-panel":"Hide Community Panel","disable-postcount-prompt":"Disable Post Count Prompt","job-keywords":"Job Keywords","hide-job-guidance":"Hide Job Guidance","hide-ai-button":"Hide AI Button","hide-promoted-jobs":"Hide Promoted Jobs"};let de={};const re=async e=>{if(JSON.stringify(de)===JSON.stringify(e))return;const t=(t,o)=>{const n=e[t]!==de[t]||e["gentle-mode"]!==de["gentle-mode"]||e["main-toggle"]!==de["main-toggle"];return n&&console.log(`LinkOff: Toggling ${t} to ${e[t]}`),n&&e[t]==o};let o=e["gentle-mode"]?"dim":"hide";const n=e["main-toggle"];!function(e){T(e),S(e)}(t),v(t,n,o,e),ae(t,n,o,e),q(t,n,o),de=e};const le={get:(ce={async get(e){const t={};for(const o of e){const e=GM_getValue(o,void 0);void 0!==e&&(t[o]=e)}return t},async set(e){for(const[t,o]of Object.entries(e))GM_setValue(t,o)}}).get,set:ce.set,onChanged:()=>{}};var ce;(()=>{const e=document.createElement("style");e.textContent='\n    /* Hide mode */\n    .hide[class] {\n      display: none !important;\n    }\n\n    /* Dim mode */\n    .dim:not(:hover) {\n      box-shadow: none;\n    }\n\n    .dim:not(:hover) > * {\n      opacity: 0.05 !important;\n      filter: alpha(opacity=5);\n    }\n\n    /* Show forbidden icon when dimmed */\n    .dim.showIcon:not(:hover)::after {\n      content: \'\';\n      position: absolute;\n      z-index: 1;\n      width: 30px;\n      height: 30px;\n      background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="red"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/></svg>\');\n      background-size: contain;\n      background-repeat: no-repeat;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n    }\n\n    /* On hover, increase opacity to 50% */\n    .dim:hover > * {\n      opacity: 0.5;\n      filter: alpha(opacity=50);\n    }\n\n    /* Wide mode */\n    .wide-mode {\n      margin-left: 0rem !important;\n      margin-right: 0rem !important;\n      padding-left: 2rem !important;\n      padding-right: 2rem !important;\n      width: 100% !important;\n    }\n  ',document.head.appendChild(e)})(),(()=>{for(const[e,t]of Object.entries(se))if("boolean"==typeof t){const o=ie[e]||e;GM_registerMenuCommand(`Toggle: ${o}`,async()=>{const n=GM_getValue(e,t);GM_setValue(e,!n),alert(`LinkOff: ${o} is now ${n?"OFF":"ON"}\n\nRefresh the page to apply changes.`)})}GM_registerMenuCommand("Reset all settings to defaults",()=>{if(confirm("Reset all LinkOff settings to defaults?")){for(const[e,t]of Object.entries(se))GM_setValue(e,t);alert("Settings reset. Refresh the page to apply changes.")}}),GM_registerMenuCommand("About LinkOff",()=>{alert("LinkOff - LinkedIn Filter and Customizer\n\nBy Noah Jelich\nhttps://github.com/njelich/LinkOff\n\nUse the menu commands above to toggle settings.\nRefresh the page after changing settings.")})})(),async function(e,t={}){const{onMessage:o}=t,n=async()=>{const t=Object.keys(se),o=await e.get(t),n={...se,...o};re(n)};e.onChanged(e=>{n()}),o&&o(async e=>{if(e["unfollow-all"]){if(!window.location.href.includes("/mynetwork/network-manager/people-follow"))return void alert("No messages. Are you on the follows page (/mynetwork/network-manager/people-follow)?\n\nIf not, please navigate to following using the LinkedIn navbar and then click the Unfollow All button again.");await Y()}});let a=window.location.href;setInterval(()=>{window.location.href!==a&&(a=window.location.href,de={},n(),window.location.href.includes("/messaging/")&&p())},500),"loading"!==document.readyState?(n(),window.location.href.includes("/messaging/")&&p()):document.addEventListener("DOMContentLoaded",()=>{n(),window.location.href.includes("/messaging/")&&p()})}(le)}();
