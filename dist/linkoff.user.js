// ==UserScript==
// @name         LinkOff
// @namespace    https://github.com/njelich/LinkOff
// @version      1.10.0
// @description  Filter and customize your LinkedIn feed - hide promoted posts, suggestions, reactions, and more
// @author       Noah Jelich
// @match        https://www.linkedin.com/*
// @match        https://linkedin.com/*
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_registerMenuCommand
// @run-at       document-idle
// @homepageURL  https://github.com/njelich/LinkOff
// @supportURL   https://github.com/njelich/LinkOff/issues
// @license      MIT
// ==/UserScript==


!function(){"use strict";const e={FEED_POST_ACTIVITY:'[data-id*="urn:li:activity"]',FEED_POST_AGGREGATE:'[data-id*="urn:li:aggregate"]',JOB_POST_ID:"[data-job-id]",JOB_POST_OCCLUDABLE:"[data-occludable-job-id]",JOB_LIST_ITEM:".discovery-templates-vertical-list__list-item",FEED_POLL:"poll",FEED_VIDEO_VJS:'id="vjs_video_',FEED_VIDEO_COMPONENTS:"update-components-linkedin-video",FEED_VIDEO_SHARED:"feed-shared-linkedin-video",FEED_LINK:"https://lnkd.in/",FEED_IMAGE:'class="update-components-image__image-link',FEED_SHARED_POST:"feed-shared-mini-update-v2",FEED_CAROUSEL:"iframe",FEED_COMPANY_LINK:'href="https://www.linkedin.com/company/',FEED_PERSON_LINK:'href="https://www.linkedin.com/in/',FEED_TEXT_PROMOTED:"Promoted",FEED_TEXT_SUGGESTED:"Suggested",FEED_TEXT_FOLLOWING:"following",FEED_TEXT_LIKES_THIS:"likes this",FEED_TEXT_LIKE_THIS:"like this",FEED_TEXT_LOVES_THIS:"loves this",FEED_TEXT_INSIGHTFUL:"finds this insightful",FEED_TEXT_CELEBRATES:"celebrates this",FEED_TEXT_CURIOUS:"is curious about this",FEED_TEXT_SUPPORTS:"supports this",FEED_TEXT_FUNNY:"finds this funny",FEED_TEXT_COMMENTED:"commented on this",FEED_TEXT_REPOSTED:"reposted this",FEED_CONTAINER:"scaffold-finite-scroll__content",FEED_SORT_DROPDOWN_TRIGGER:"button.full-width.artdeco-dropdown__trigger.artdeco-dropdown__trigger--placement-bottom",FEED_SORT_RECENT_OPTION:"ul > li:nth-child(2) > div.artdeco-dropdown__item.artdeco-dropdown__item--is-dropdown",JOBS_GUIDANCE:"artdeco-card mb2 pt5",JOBS_AI_BUTTON:"ember-view link-without-hover-state artdeco-button",MISC_LEARNING_TOP:"learning-top-courses",MISC_LEARNING_RECOMMENDATIONS:"pv-course-recommendations",MISC_AD_BANNER_CONTAINER:"ad-banner-container",MISC_ADS_CONTAINER:"ads-container",MISC_AD_BANNER:"ad-banner",MISC_AD_RAIL:"pv-right-rail__sticky-ad-banner",MISC_COMMUNITY_PANEL:"community-panel",MISC_FOLLOW_MODULE:"feed-follows-module",MISC_ACCOUNT_BUILDING_1:"artdeco-card ember-view mt2",MISC_ACCOUNT_BUILDING_2:"artdeco-card mb4 overflow-hidden ember-view",MISC_NETWORK_ABI:"mn-abi-form",MISC_NETWORK_PYMK:"pv-profile-pymk__container artdeco-card",MISC_PREMIUM_UPSELL_LINK:"premium-upsell-link",MISC_PREMIUM_PROMO_CARD:"gp-promo-embedded-card-three__card",MISC_PREMIUM_CARD_PH1:"artdeco-card overflow-hidden ph1 mb2",MISC_PREMIUM_ACCENT_BAR:"artdeco-card premium-accent-bar",MISC_PREMIUM_UPSELL_CONTAINER:"pvs-premium-upsell__container",MISC_PREMIUM_BLURRED:"pvs-entity--blurred",MISC_PREMIUM_TAB:"artdeco-tab ember-view",MISC_NEWS_MODULE:"news-module",MISC_NEWS_WITH_GAME:"news-module--with-game",MISC_NOTIFICATION_COUNT:"notification-badge__count",MISC_PROFILE_COUNTER_CHILD:"entity-list-wrapper",MISC_PROFILE_COUNTER_PARENT:".artdeco-card",UNFOLLOW_BUTTON:'button[aria-label^="Click to stop"]',MESSAGES_LIST:".msg-conversations-container__conversations-list",MESSAGES_DROPDOWN:".msg-conversations-container__dropdown-container",MESSAGES_DROPDOWN_INNER:".msg-conversations-container__dropdown-container > div",MESSAGES_TITLE_BUTTON:".msg-conversations-container__title-row button.artdeco-dropdown__trigger"},n=[e.FEED_POST_ACTIVITY,e.FEED_POST_AGGREGATE],t=[e.JOB_POST_ID,e.JOB_POST_OCCLUDABLE,e.JOB_LIST_ITEM],o="[data-hidden=false]",i="h •",a="d •",s="w •",d="mo •",l="y •",r=(e,n=void 0)=>{const t=(n??document).querySelectorAll(e);return!(t.length>0)||Array.from(t).some(e=>e.innerHTML.includes("skeleton"))},c=e=>{const n=document.getElementsByClassName(e);return!(n.length>0)||Array.from(n).some(e=>e.innerHTML.includes("skeleton"))},f=async e=>{for(;c(e);)await new Promise(e=>{requestAnimationFrame(e)});return document.getElementsByClassName(e)},m=(e,n)=>{let t=0;const o=setInterval(()=>{e()||t>=10?clearInterval(o):(n(),t+=1)},350)},h=async(e,n,t=!0)=>{const o=await f(e);for(let e of o)e.classList.remove("hide","dim","showIcon"),e.classList.add(n),t&&e.classList.add("showIcon"),m(()=>e.classList.contains(n),()=>{e.classList.remove("hide","dim","showIcon"),e.classList.add(n),t&&e.classList.add("showIcon")})},g=async e=>{const n=await f(e);for(let e of n)e.classList.remove("hide","dim","showIcon")},p=(e,n)=>{let t=[];switch(n){case"all":t=e;break;case"blocked":t=e.map(e=>`${e}[data-hidden=true]`);break;case"shown":t=e.map(e=>`${e}${o}`);break;case"pristine":t=e.map(e=>`${e}${o},${e}:not([data-hidden])`)}return t.join(",")},_=()=>{console.log("LinkOff: Reset shown posts"),document.querySelectorAll(p(n,"shown")).forEach(e=>{e.classList.remove("hide","dim","showIcon"),delete e.dataset.hidden})},E=()=>{console.log("LinkOff: Resetting blocked posts"),document.querySelectorAll(p(n,"blocked")).forEach(e=>{e.classList.remove("hide","dim","showIcon"),delete e.dataset.hidden})},u=()=>{console.log("LinkOff: Reset shown jobs"),document.querySelectorAll(p(t,"all")).forEach(e=>{e.classList.remove("hide","dim","showIcon"),delete e.dataset.hidden})},b=async()=>{console.log("LinkOff: Waiting for Messages to load");const n=e.MESSAGES_DROPDOWN.replace(/^\./,"");await f(n);const t=document.querySelector(e.MESSAGES_DROPDOWN_INNER),o=new MutationObserver(function(){const n=t.querySelector("ul");if(!n)return;const o=document.createElement("div");o.classList.add("artdeco-dropdown__item","artdeco-dropdown__item--is-dropdown","ember-view"),o.textContent="Select all for deletion (LinkOff)",o.onclick=function(){document.querySelector(e.MESSAGES_TITLE_BUTTON).click(),(async()=>{const n=document.querySelector(e.MESSAGES_LIST);if(!n)return void alert("No messages. Are you on the messaging page?\n\nIf not, please navigate to messaging using the LinkedIn navbar and then click the Select Messages for Deletion button again.");await async function(){return await new Promise(e=>{let t=0,o=0;if(n){const i=setInterval(()=>{const{scrollHeight:a}=n;a>2e4&&(clearInterval(i),e()),a===t&&(o>=3?(clearInterval(i),e()):o++),t=a,n.scrollTop=a},1e3)}else alert("The page took too long to load. Please try again.")})}();const t=n.getElementsByTagName("label");for(let e=0;e<t.length;e++)t[e]&&t[e].click();alert("Click the trash can icon at the top to delete all messages.")})()},console.log('LinkOff: Adding "Select messages for deletion" button'),n.appendChild(o)});o.observe(t,{attributes:!1,childList:!0,subtree:!1,characterData:!1})},I=":root{--black:#000;--black-a90:rgba(0,0,0,0.9);--black-a75:rgba(0,0,0,0.75);--black-a60:rgba(0,0,0,0.6);--black-a45:rgba(0,0,0,0.45);--black-a30:rgba(0,0,0,0.3);--black-a15:rgba(0,0,0,0.15);--black-a12:rgba(0,0,0,0.12);--black-a08:rgba(0,0,0,0.08);--black-a04:rgba(0,0,0,0.04);--white:#fff;--white-a90:hsla(0,0%,100%,0.9);--white-a85:hsla(0,0%,100%,0.85);--white-a70:hsla(0,0%,100%,0.7);--white-a55:hsla(0,0%,100%,0.55);--white-a40:hsla(0,0%,100%,0.4);--white-a25:hsla(0,0%,100%,0.25);--white-a18:hsla(0,0%,100%,0.18);--white-a12:hsla(0,0%,100%,0.12);--white-a06:hsla(0,0%,100%,0.06);--blue-10:#f6fbff;--blue-20:#e8f3ff;--blue-30:#d0e8ff;--blue-40:#a8d4ff;--blue-50:#70b5f9;--blue-50-a20:rgba(112,181,249,0.2);--blue-50-a30:rgba(112,181,249,0.3);--blue-60:#378fe9;--blue-70:#0a66c2;--blue-80:#004182;--blue-90:#09223b;--cool-gray-10:#f9fafb;--cool-gray-20:#eef3f8;--cool-gray-30:#dce6f1;--cool-gray-40:#c0d1e2;--cool-gray-50:#9db3c8;--cool-gray-60:#788fa5;--cool-gray-70:#56687a;--cool-gray-80:#38434f;--cool-gray-90:#1d2226;--warm-gray-10:#fafaf9;--warm-gray-20:#f3f2ef;--warm-gray-30:#e9e5df;--warm-gray-40:#d6cec2;--warm-gray-50:#b9af9f;--warm-gray-60:#958b7b;--warm-gray-70:#6e6558;--warm-gray-80:#474139;--warm-gray-90:#211f1c;--warm-red-10:#fff9f7;--warm-red-20:#ffefea;--warm-red-30:#ffded5;--warm-red-40:#fdc2b1;--warm-red-50:#f5987e;--warm-red-60:#e16745;--warm-red-70:#b24020;--warm-red-80:#762812;--warm-red-90:#351a12;--teal-10:#eefdff;--teal-20:#d5f9fe;--teal-30:#aef0fa;--teal-40:#79deee;--teal-50:#44bfd3;--teal-50-a30:rgba(68,191,211,0.3);--teal-60:#2199ac;--teal-70:#13707e;--teal-80:#104952;--teal-90:#0e2428;--purple-10:#fcf9ff;--purple-20:#f7efff;--purple-30:#eedfff;--purple-40:#dec5fd;--purple-40-a15:rgba(222,197,253,0.15);--purple-50:#c79ef7;--purple-60:#a872e8;--purple-70:#8344cc;--purple-70-a15:rgba(131,68,204,0.15);--purple-80:#592099;--purple-90:#2c1349;--system-red-10:#fff9f9;--system-red-20:#ffeeef;--system-red-30:#ffddde;--system-red-40:#ffbfc1;--system-red-50:#fc9295;--system-red-60:#f55257;--system-red-70:#cc1016;--system-red-80:#8a0005;--system-red-90:#46080a;--system-green-10:#f0fdf7;--system-green-20:#dbf9eb;--system-green-30:#b6f2d6;--system-green-40:#7ce3b3;--system-green-50:#3ec786;--system-green-60:#13a05f;--system-green-70:#057642;--system-green-80:#004d2a;--system-green-90:#022716;--pink-10:#fff8ff;--pink-20:#ffedfe;--pink-30:#ffdafd;--pink-40:#fcb9f9;--pink-50:#f489ee;--pink-60:#dd51d6;--pink-70:#b11faa;--pink-80:#770c72;--pink-90:#3d0a3b;--amber-10:#fdfaf5;--amber-20:#fbf1e2;--amber-30:#fce2ba;--amber-40:#f8c77e;--amber-50:#e7a33e;--amber-60:#c37d16;--amber-70:#915907;--amber-80:#5d3b09;--amber-90:#2a1f0e;--copper-10:#fcfaf9;--copper-20:#fcf0ed;--copper-30:#fadfd8;--copper-40:#f2c5b8;--copper-50:#e0a191;--copper-60:#be7b6a;--copper-70:#8f5849;--copper-80:#5d392f;--copper-90:#2d1d19;--green-10:#f6fcf4;--green-20:#e3f9d8;--green-30:#c7f1b2;--green-40:#a5df89;--green-50:#7fc15e;--green-60:#5f9b41;--green-70:#44712e;--green-80:#2f4922;--green-90:#1b2416;--sage-10:#f8fbf6;--sage-20:#eaf6e4;--sage-30:#d7ebce;--sage-40:#bdd7b0;--sage-50:#9db88f;--sage-60:#7b9370;--sage-70:#5a6b51;--sage-80:#3a4535;--sage-90:#1e221c;--lime-10:#f9fce9;--lime-20:#eff8b9;--lime-30:#dfee89;--lime-40:#c6d957;--lime-50:#a6ba32;--lime-60:#83941f;--lime-70:#5f6c16;--lime-80:#3e4613;--lime-90:#20230f;--camo-10:#fafbf3;--camo-20:#f1f4e4;--camo-30:#e4e8cc;--camo-40:#cdd3ac;--camo-50:#aeb48a;--camo-60:#8a8f6c;--camo-70:#65684e;--camo-80:#414335;--camo-90:#21211d;--smoke-10:#f8fafb;--smoke-20:#edf3f4;--smoke-30:#dbe7e9;--smoke-40:#bfd3d6;--smoke-50:#a0b4b7;--smoke-60:#7d8f92;--smoke-70:#5b696b;--smoke-80:#3c4345;--smoke-90:#1f2122;--lavender-10:#fbf9fd;--lavender-20:#f4f1f9;--lavender-30:#eae2f3;--lavender-40:#d7cae7;--lavender-50:#bba9d1;--lavender-60:#9983b1;--lavender-70:#715e86;--lavender-80:#493d57;--lavender-90:#241f29;--mauve-10:#fcf9fc;--mauve-20:#f9eff8;--mauve-30:#f2e0f1;--mauve-40:#e5c6e3;--mauve-50:#cea2cc;--mauve-60:#ac7da9;--mauve-70:#80597e;--mauve-80:#523a51;--mauve-90:#271e27;--system-gray-10:#fafafa;--system-gray-20:#f2f2f2;--system-gray-30:#e5e5e5;--system-gray-40:#cfcfcf;--system-gray-50:#b0b0b0;--system-gray-60:#8c8c8c;--system-gray-70:#666;--system-gray-80:#424242;--system-gray-90:#212121;--system-orange-10:#fff9f6;--system-orange-20:#ffefe8;--system-orange-30:#ffdfd1;--system-orange-40:#ffc1a7;--system-orange-50:#ff9466;--system-orange-60:#eb6126;--system-orange-70:#b93a04;--system-orange-80:#792603;--system-orange-90:#351a0f;--transparent:transparent;--transparent-white:hsla(0,0%,100%,0);",w=()=>{const e=document.createElement("style"),n=e=>{return(parseInt(e)+(n=220,t=255,Math.floor(Math.random()*(t-n)+n)))%256;var n,t};e.innerHTML=I.replace(/100%|0%/g,e=>"100%"==e?"0%":"100%").replace(/#000|#fff/g,e=>"#fff"==e?"#000":"#fff").replace(/#([fe])(.)([fe])(.)([fe])(.)/g,"#1$21$41$6").replace(/\d+(?=,)/g,e=>n(e)),e.innerHTML+="--color-background-brand-accent-4: var(--cool-gray-90);",document.body.appendChild(e)};let k;const T=e=>{e("dark-mode",!0)?w():(()=>{const e=document.createElement("style");e.innerHTML=I,document.body.appendChild(e)})()},y=e=>{e("wide-mode",!0)?(k=document.getElementsByClassName("scaffold-layout__inner scaffold-layout-container scaffold-layout-container--reflow")[0]||k,k&&k.classList.add("wide-mode")):k&&k.classList.remove("wide-mode")};let S,O=0,L=!1,M=[],C=[];const N=(e,n)=>{const t=n=>{if(n)for(let n=2;n<=30;n++)e.push(`text::${n}${a}`);else e.push(`text::${a}`);o(!1)},o=n=>{if(n)for(let n=2;n<=4;n++)e.push(`text::${n}${s}`);else e.push(`text::${s}`);r(!1)},r=n=>{if(n)for(let n=2;n<=12;n++)e.push(`text::${n}${d}`);else e.push(`text::${d}`);c(!1)},c=n=>{if(n)for(let n=2;n<=5;n++)e.push(`text::${n}${l}`);else e.push(`text::${l}`)};switch(n){case"hour":((n=!0)=>{if(n)for(let n=2;n<=24;n++)e.push(`text::${n}${i}`);else e.push(`text::${i}`);t(!1)})(e);break;case"day":t(e);break;case"week":o(e);break;case"month":r(e);break;case"year":c(e)}},v=async n=>{let t=0,o=!1,i=e.FEED_CONTAINER;if("https://www.linkedin.com/feed/"==window.location.href)for(;!o&&t<50;)await new Promise(e=>{setTimeout(()=>{n?(document.getElementsByClassName(i).item(0).classList.remove("hide"),console.log("LinkOff: feed enabled")):(document.getElementsByClassName(i).item(0).classList.add("hide"),console.log("LinkOff: feed disabled")),o=!0,t+=1,e()},100+10*t)})},D=async()=>{if("https://www.linkedin.com/feed/"!==window.location.href&&"https://www.linkedin.com/"!==window.location.href)return;const n=await(async e=>{for(;r(e);)await new Promise(e=>{requestAnimationFrame(e)});return document.querySelector(e)})(e.FEED_SORT_DROPDOWN_TRIGGER),t=n.parentElement;n.click();(await(async(e,n)=>{for(;r(`:scope ${e}`,n);)await new Promise(e=>{requestAnimationFrame(e)});return n.querySelector(`:scope ${e}`)})(e.FEED_SORT_RECENT_OPTION,t)).click()},R=(e,t)=>{v(!0),E(),clearInterval(S),((e,t,o)=>{let i;C.some(n=>!e.includes(n))&&_(),C=e,e.length&&(S=setInterval(()=>{O%10==0&&E(),i=document.querySelectorAll(p(n,"pristine")),console.log(`LinkOff: Found ${i.length} unblocked posts`),i.length>5||"dim"==t?i.forEach(n=>{let o;e.some((e,t)=>{o=t;const i=e.split("::");return i.length>1?-1!==n.innerText.indexOf(i[1]):-1!==n.innerHTML.indexOf(i[0])})?(((e,n)=>{e.classList.add(n,"showIcon"),e.onclick=()=>{e.classList.remove("hide","dim","showIcon"),e.dataset.hidden="shown"},e.dataset.hidden=!0})(n,t),console.log(`LinkOff: Blocked post ${n.getAttribute("data-id")} for keyword ${e[o]}`)):(n.classList.remove("hide","dim","showIcon"),n.dataset.hidden=!1)}):L||o||(L=!0,alert("Scroll down to start blocking posts (LinkedIn needs at least 10 loaded to load new ones).\n\nTo disable this alert, toggle it under misc in LinkOff settings")),O++},350))})(M,e,t["disable-postcount-prompt"])};function A(n,t,o,i){if(n("main-toggle",!1))return v(!0),clearInterval(S),E(),void _();t&&(n("sort-by-recent",!0)&&D(),M=(n=>{let t=""==n["feed-keywords"]?[]:n["feed-keywords"].split(",");const o=n["hide-by-age"];return"disabled"!==o&&N(t,o),n["hide-polls"]&&t.push(e.FEED_POLL),n["hide-videos"]&&t.push(e.FEED_VIDEO_VJS,e.FEED_VIDEO_COMPONENTS,e.FEED_VIDEO_SHARED),n["hide-links"]&&t.push(e.FEED_LINK),n["hide-images"]&&t.push(e.FEED_IMAGE),n["hide-promoted"]&&t.push(`text::${e.FEED_TEXT_PROMOTED}`),n["hide-shared"]&&t.push(e.FEED_SHARED_POST),n["hide-followed"]&&t.push(`text::${e.FEED_TEXT_FOLLOWING}`),n["hide-liked"]&&t.push(`text::${e.FEED_TEXT_LIKES_THIS}`,`text::${e.FEED_TEXT_LIKE_THIS}`),n["hide-other-reactions"]&&t.push(`text::${e.FEED_TEXT_LOVES_THIS}`,`text::${e.FEED_TEXT_INSIGHTFUL}`,`text::${e.FEED_TEXT_CELEBRATES}`,`text::${e.FEED_TEXT_CURIOUS}`,`text::${e.FEED_TEXT_SUPPORTS}`,`text::${e.FEED_TEXT_FUNNY}`),n["hide-commented-on"]&&t.push(`text::${e.FEED_TEXT_COMMENTED}`),n["hide-by-companies"]&&t.push(e.FEED_COMPANY_LINK),n["hide-by-people"]&&t.push(e.FEED_PERSON_LINK),n["hide-suggested"]&&t.push(`text::${e.FEED_TEXT_SUGGESTED}`),n["hide-carousels"]&&t.push(e.FEED_CAROUSEL),n["first-degree-only"]&&t.push(`text::${e.FEED_TEXT_LIKES_THIS}`,`text::${e.FEED_TEXT_LIKE_THIS}`,`text::${e.FEED_TEXT_LOVES_THIS}`,`text::${e.FEED_TEXT_INSIGHTFUL}`,`text::${e.FEED_TEXT_CELEBRATES}`,`text::${e.FEED_TEXT_CURIOUS}`,`text::${e.FEED_TEXT_SUPPORTS}`,`text::${e.FEED_TEXT_FUNNY}`,`text::${e.FEED_TEXT_COMMENTED}`,`text::${e.FEED_TEXT_FOLLOWING}`,`text::${e.FEED_TEXT_REPOSTED}`),console.log("LinkOff: Current feed keywords are",t),t})(i),n("hide-whole-feed",!0)?(v(!1),E(),clearInterval(S)):M!==C&&R(o,i))}const x=()=>{g(e.MISC_LEARNING_TOP),g(e.MISC_LEARNING_RECOMMENDATIONS)},P=()=>{g(e.MISC_AD_BANNER_CONTAINER),g(e.MISC_ADS_CONTAINER),g(e.MISC_AD_BANNER),g(e.MISC_AD_RAIL)},F=()=>{g(e.MISC_COMMUNITY_PANEL)},U=()=>{g(e.MISC_FOLLOW_MODULE)},$=()=>{g(e.MISC_ACCOUNT_BUILDING_1),g(e.MISC_ACCOUNT_BUILDING_2)},H=()=>{g(e.MISC_NETWORK_ABI),g(e.MISC_NETWORK_PYMK)},B=()=>{g(e.MISC_PREMIUM_UPSELL_LINK),g(e.MISC_PREMIUM_PROMO_CARD),g(e.MISC_PREMIUM_CARD_PH1),g(e.MISC_PREMIUM_ACCENT_BAR),g(e.MISC_PREMIUM_UPSELL_CONTAINER),g(e.MISC_PREMIUM_BLURRED),(async(e,n)=>{const t=(await f(e))[n];t&&t.classList.remove("hide","dim","showIcon")})(e.MISC_PREMIUM_TAB,1)},G=(n,t)=>{n("hide-premium",!0)?(h(e.MISC_PREMIUM_UPSELL_LINK,t,!1),h(e.MISC_PREMIUM_PROMO_CARD,t),h(e.MISC_PREMIUM_CARD_PH1,t,!1),h(e.MISC_PREMIUM_UPSELL_CONTAINER,t,!1),h(e.MISC_PREMIUM_BLURRED,t,!1),h(e.MISC_PREMIUM_ACCENT_BAR,t),(async(e,n,t,o=!0)=>{const i=(await f(e))[n];i&&(i.classList.remove("hide","dim","showIcon"),i.classList.add(t,o&&"showIcon"))})(e.MISC_PREMIUM_TAB,1,t,!1)):B()},j=()=>{g(e.MISC_NEWS_MODULE),g(e.MISC_NEWS_WITH_GAME)},X=()=>{g(e.MISC_NOTIFICATION_COUNT)},W=()=>{(async(e,n)=>{const t=await f(e);for(let e of t)e.closest(n)?.classList.remove("hide","dim","showIcon")})(e.MISC_PROFILE_COUNTER_CHILD,e.MISC_PROFILE_COUNTER_PARENT)},K=(n,t)=>{n("hide-profile-counters",!0)?(async(e,n,t,o=!0)=>{const i=await f(e);for(let e of i){const i=e.closest(n);if(!i)return;i.classList.remove("hide","dim","showIcon"),i.classList.add(t),o&&i.classList.add("showIcon"),m(()=>i.classList.contains(t),()=>{i.classList.remove("hide","dim","showIcon"),i.classList.add(t),o&&i.classList.add("showIcon")})}})(e.MISC_PROFILE_COUNTER_CHILD,e.MISC_PROFILE_COUNTER_PARENT,t,!1):X()};let q;const J=(n,t)=>{((n,t)=>{n("hide-linkedin-learning",!0)?(h(e.MISC_LEARNING_TOP,t),h(e.MISC_LEARNING_RECOMMENDATIONS,t)):x()})(n,t),((n,t)=>{n("hide-community-panel",!0)?h(e.MISC_COMMUNITY_PANEL,t):F()})(n,t),((n,t)=>{n("hide-follow-recommendations",!0)?h(e.MISC_FOLLOW_MODULE,t):U()})(n,t),((n,t)=>{n("hide-account-building",!0)?(h(e.MISC_ACCOUNT_BUILDING_1,t),h(e.MISC_ACCOUNT_BUILDING_2,t)):$()})(n,t),((n,t)=>{n("hide-network-building",!0)?(h(e.MISC_NETWORK_ABI,t),h(e.MISC_NETWORK_PYMK,t)):H()})(n,t),G(n,t),((n,t)=>{n("hide-news",!0)?(h(e.MISC_NEWS_MODULE,t),h(e.MISC_NEWS_WITH_GAME,t)):j()})(n,t),((n,t)=>{n("hide-advertisements",!0)?(h(e.MISC_AD_BANNER_CONTAINER,t),h(e.MISC_ADS_CONTAINER,t),h(e.MISC_AD_BANNER,t),h(e.MISC_AD_RAIL,t)):P()})(n,t),(n=>{n("hide-notification-count",!0)?h(e.MISC_NOTIFICATION_COUNT,"hide",!1):X()})(n),K(n,t)};function V(e,n,t){e("main-toggle",!1)&&(j(),X(),$(),H(),P(),F(),U(),B(),x(),W(),clearInterval(q)),n&&(J(e,t),q&&clearInterval(q),q=setInterval(()=>{J(e,t)},500))}const z=async()=>{let n=document.querySelectorAll(e.UNFOLLOW_BUTTON)||[];n.length||console.log("LinkOff: Successfully unfollowed all");for(let e of n)window.scrollTo(0,e.offsetTop-260),e.click(),await new Promise(e=>setTimeout(e,100));window.scrollTo(0,document.body.scrollHeight),await new Promise(e=>setTimeout(e,1e3)),n=document.querySelectorAll(e.UNFOLLOW_BUTTON)||[],n.length&&z()};let Y,Q=0,Z=[],ee=[];const ne=()=>{clearInterval(Y),u(),te(),oe()},te=()=>{g(e.JOBS_GUIDANCE)},oe=()=>{g(e.JOBS_AI_BUTTON)};function ie(n,o,i,a){n("main-toggle",!1)?ne():o&&(Z=(e=>{let n=""==e["job-keywords"]?[]:e["job-keywords"].split(",");return e["hide-promoted-jobs"]&&n.push("Promoted"),console.log("LinkOff: Current job keywords are",n),n})(a),Z===ee&&0!==Z.length||(ne(),((e,n)=>{if(!window.location.href.startsWith("https://www.linkedin.com/jobs/"))return;let o;ee.some(n=>!e.includes(n))&&u(),ee=e,e.length&&(Y=setInterval(()=>{Q%10==0&&u(),o=document.querySelectorAll(p(t,"all")),console.log(`LinkOff: Found ${o.length} unblocked jobs`),o.forEach(t=>{let o;e.some((e,n)=>(o=n,-1!==t.innerHTML.toLowerCase().indexOf(e.toLowerCase())))?(t.classList.add(n,"showIcon"),console.log(`LinkOff: Blocked job ${t.getAttribute("data-occludable-job-id")} for keyword ${e[o]}`)):t.classList.remove("hide","dim","showIcon")}),Q++},350))})(Z,i)),((n,t)=>{n("hide-job-guidance",!0)?h(e.JOBS_GUIDANCE,t):(n("main-toggle",!1)||n("hide-job-guidance",!1))&&te()})(n,i),((n,t)=>{n("hide-ai-button",!0)?h(e.JOBS_AI_BUTTON,t,!1):(n("main-toggle",!1)||n("hide-ai-button",!1))&&oe()})(n,i))}const ae={"gentle-mode":!0,"dark-mode":!1,"main-toggle":!0,"wide-mode":!1,"hide-whole-feed":!1,"hide-by-age":"week","feed-keywords":"","hide-shared":!1,"hide-videos":!1,"hide-liked":!0,"hide-suggested":!0,"hide-other-reactions":!1,"sort-by-recent":!0,"hide-carousels":!1,"hide-by-companies":!0,"hide-by-people":!1,"hide-commented-on":!1,"hide-followed":!0,"first-degree-only":!1,"hide-images":!1,"hide-links":!1,"hide-polls":!0,"hide-promoted":!0,"hide-linkedin-learning":!0,"hide-premium":!0,"hide-account-building":!0,"hide-network-building":!0,"hide-advertisements":!0,"hide-follow-recommendations":!0,"hide-news":!1,"hide-notification-count":!1,"hide-profile-counters":!1,"hide-community-panel":!0,"disable-postcount-prompt":!1,"job-keywords":"","hide-job-guidance":!1,"hide-ai-button":!1,"hide-promoted-jobs":!1},se={"gentle-mode":"Gentle Mode (Dim Instead of Hide)","dark-mode":"Dark Mode","main-toggle":"Enable LinkOff","wide-mode":"Wide Mode","hide-whole-feed":"Hide Entire Feed","hide-by-age":"Hide Posts by Age","feed-keywords":"Feed Keywords","hide-shared":"Hide Shared Posts","hide-videos":"Hide Videos","hide-liked":'Hide "Liked by" Posts',"hide-suggested":"Hide Suggested Posts","hide-other-reactions":"Hide Other Reactions","sort-by-recent":"Sort by Recent","hide-carousels":"Hide Carousels","hide-by-companies":"Hide Company Posts","hide-by-people":"Hide People Posts","hide-commented-on":'Hide "Commented on" Posts',"hide-followed":"Hide Following Posts","first-degree-only":"First-Degree Only (Hide All Engagement Posts)","hide-images":"Hide Images","hide-links":"Hide Links","hide-polls":"Hide Polls","hide-promoted":"Hide Promoted Posts","hide-linkedin-learning":"Hide LinkedIn Learning","hide-premium":"Hide Premium Upsells","hide-account-building":"Hide Account Building","hide-network-building":"Hide Network Building","hide-advertisements":"Hide Advertisements","hide-follow-recommendations":"Hide Follow Recommendations","hide-news":"Hide News","hide-notification-count":"Hide Notification Count","hide-profile-counters":"Hide Profile Counters","hide-community-panel":"Hide Community Panel","disable-postcount-prompt":"Disable Post Count Prompt","job-keywords":"Job Keywords","hide-job-guidance":"Hide Job Guidance","hide-ai-button":"Hide AI Button","hide-promoted-jobs":"Hide Promoted Jobs"};let de={};const le=async e=>{if(JSON.stringify(de)===JSON.stringify(e))return;const n=(n,t)=>{const o=e[n]!==de[n]||e["gentle-mode"]!==de["gentle-mode"]||e["main-toggle"]!==de["main-toggle"];return o&&console.log(`LinkOff: Toggling ${n} to ${e[n]}`),o&&e[n]==t};let t=e["gentle-mode"]?"dim":"hide";const o=e["main-toggle"];!function(e){y(e),T(e)}(n),A(n,o,t,e),ie(n,o,t,e),V(n,o,t),de=e};const re={get:(ce={async get(e){const n={};for(const t of e){const e=GM_getValue(t,void 0);void 0!==e&&(n[t]=e)}return n},async set(e){for(const[n,t]of Object.entries(e))GM_setValue(n,t)}}).get,set:ce.set,onChanged:()=>{}};var ce;const fe={general:{title:"General",settings:["main-toggle","gentle-mode","wide-mode","dark-mode"]},feed:{title:"Feed",settings:["hide-whole-feed","sort-by-recent","first-degree-only","hide-promoted","hide-suggested","hide-liked","hide-other-reactions","hide-commented-on","hide-followed","hide-shared","hide-polls","hide-videos","hide-images","hide-links","hide-carousels","hide-by-companies","hide-by-people"]},jobs:{title:"Jobs",settings:["hide-job-guidance","hide-ai-button","hide-promoted-jobs"]},misc:{title:"Misc",settings:["disable-postcount-prompt","hide-linkedin-learning","hide-advertisements","hide-follow-recommendations","hide-notification-count","hide-profile-counters","hide-community-panel","hide-account-building","hide-network-building","hide-premium","hide-news"]}};function me(e,n={}){let t={};const o=document.createElement("style");o.textContent='\n  .linkoff-settings-btn {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: #0a66c2;\n    color: white;\n    border: none;\n    cursor: pointer;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    z-index: 9999;\n    font-size: 24px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s, background 0.2s;\n  }\n\n  .linkoff-settings-btn:hover {\n    background: #004182;\n    transform: scale(1.1);\n  }\n\n  .linkoff-settings-btn svg {\n    width: 24px;\n    height: 24px;\n    fill: currentColor;\n  }\n\n  .linkoff-panel-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0,0,0,0.5);\n    z-index: 10000;\n    display: none;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .linkoff-panel-overlay.open {\n    display: flex;\n  }\n\n  .linkoff-panel {\n    background: white;\n    border-radius: 12px;\n    width: 90%;\n    max-width: 500px;\n    max-height: 80vh;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 0 4px 24px rgba(0,0,0,0.2);\n  }\n\n  .linkoff-panel-header {\n    padding: 16px 20px;\n    border-bottom: 1px solid #e0e0e0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    background: #f8f9fa;\n  }\n\n  .linkoff-panel-header h2 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: #333;\n  }\n\n  .linkoff-panel-close {\n    background: none;\n    border: none;\n    font-size: 24px;\n    cursor: pointer;\n    color: #666;\n    padding: 0;\n    line-height: 1;\n  }\n\n  .linkoff-panel-close:hover {\n    color: #333;\n  }\n\n  .linkoff-panel-tabs {\n    display: flex;\n    border-bottom: 1px solid #e0e0e0;\n    background: #f8f9fa;\n  }\n\n  .linkoff-panel-tab {\n    flex: 1;\n    padding: 12px 16px;\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 14px;\n    color: #666;\n    border-bottom: 2px solid transparent;\n    transition: all 0.2s;\n  }\n\n  .linkoff-panel-tab:hover {\n    background: #e8e8e8;\n  }\n\n  .linkoff-panel-tab.active {\n    color: #0a66c2;\n    border-bottom-color: #0a66c2;\n    font-weight: 500;\n  }\n\n  .linkoff-panel-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n  }\n\n  .linkoff-panel-section {\n    display: none;\n  }\n\n  .linkoff-panel-section.active {\n    display: block;\n  }\n\n  .linkoff-setting-row {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 0;\n    border-bottom: 1px solid #f0f0f0;\n  }\n\n  .linkoff-setting-row:last-child {\n    border-bottom: none;\n  }\n\n  .linkoff-setting-label {\n    font-size: 14px;\n    color: #333;\n    flex: 1;\n    padding-right: 12px;\n  }\n\n  .linkoff-toggle {\n    position: relative;\n    width: 44px;\n    height: 24px;\n    flex-shrink: 0;\n  }\n\n  .linkoff-toggle input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n  }\n\n  .linkoff-toggle-slider {\n    position: absolute;\n    cursor: pointer;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    transition: 0.3s;\n    border-radius: 24px;\n  }\n\n  .linkoff-toggle-slider:before {\n    position: absolute;\n    content: "";\n    height: 18px;\n    width: 18px;\n    left: 3px;\n    bottom: 3px;\n    background-color: white;\n    transition: 0.3s;\n    border-radius: 50%;\n  }\n\n  .linkoff-toggle input:checked + .linkoff-toggle-slider {\n    background-color: #0a66c2;\n  }\n\n  .linkoff-toggle input:checked + .linkoff-toggle-slider:before {\n    transform: translateX(20px);\n  }\n\n  .linkoff-panel-footer {\n    padding: 12px 20px;\n    border-top: 1px solid #e0e0e0;\n    background: #f8f9fa;\n    text-align: center;\n    font-size: 12px;\n    color: #666;\n  }\n\n  .linkoff-panel-footer a {\n    color: #0a66c2;\n    text-decoration: none;\n  }\n\n  .linkoff-panel-footer a:hover {\n    text-decoration: underline;\n  }\n\n  .linkoff-refresh-notice {\n    background: #fff3cd;\n    color: #856404;\n    padding: 8px 12px;\n    font-size: 12px;\n    text-align: center;\n    display: none;\n  }\n\n  .linkoff-refresh-notice.show {\n    display: block;\n  }\n\n  /* Dark mode support */\n  @media (prefers-color-scheme: dark) {\n    .linkoff-panel {\n      background: #1d2226;\n    }\n    .linkoff-panel-header {\n      background: #2d333b;\n      border-color: #444;\n    }\n    .linkoff-panel-header h2 {\n      color: #e8e8e8;\n    }\n    .linkoff-panel-close {\n      color: #aaa;\n    }\n    .linkoff-panel-tabs {\n      background: #2d333b;\n      border-color: #444;\n    }\n    .linkoff-panel-tab {\n      color: #aaa;\n    }\n    .linkoff-panel-tab:hover {\n      background: #383f46;\n    }\n    .linkoff-panel-tab.active {\n      color: #70b5f9;\n      border-bottom-color: #70b5f9;\n    }\n    .linkoff-panel-content {\n      background: #1d2226;\n    }\n    .linkoff-setting-row {\n      border-color: #333;\n    }\n    .linkoff-setting-label {\n      color: #e8e8e8;\n    }\n    .linkoff-panel-footer {\n      background: #2d333b;\n      border-color: #444;\n      color: #aaa;\n    }\n    .linkoff-panel-footer a {\n      color: #70b5f9;\n    }\n    .linkoff-refresh-notice {\n      background: #5a4a00;\n      color: #ffc107;\n    }\n  }\n',document.head.appendChild(o);const i=document.createElement("button");i.className="linkoff-settings-btn",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>',i.title="LinkOff Settings",document.body.appendChild(i);const a=document.createElement("div");a.className="linkoff-panel-overlay",a.innerHTML=`\n    <div class="linkoff-panel">\n      <div class="linkoff-panel-header">\n        <h2>LinkOff Settings</h2>\n        <button class="linkoff-panel-close">&times;</button>\n      </div>\n      <div class="linkoff-refresh-notice">\n        Settings changed. Refresh the page to apply all changes.\n      </div>\n      <div class="linkoff-panel-tabs">\n        ${Object.entries(fe).map(([e,n],t)=>`<button class="linkoff-panel-tab${0===t?" active":""}" data-tab="${e}">${n.title}</button>`).join("")}\n      </div>\n      <div class="linkoff-panel-content">\n        ${Object.entries(fe).map(([e,n],t)=>`\n          <div class="linkoff-panel-section${0===t?" active":""}" data-section="${e}">\n            ${n.settings.filter(e=>"boolean"==typeof ae[e]).map(e=>`\n              <div class="linkoff-setting-row">\n                <span class="linkoff-setting-label">${se[e]||e}</span>\n                <label class="linkoff-toggle">\n                  <input type="checkbox" data-setting="${e}">\n                  <span class="linkoff-toggle-slider"></span>\n                </label>\n              </div>\n            `).join("")}\n          </div>\n        `).join("")}\n      </div>\n      <div class="linkoff-panel-footer">\n        <a href="https://github.com/njelich/LinkOff" target="_blank">LinkOff</a> by Noah Jelich\n      </div>\n    </div>\n  `,document.body.appendChild(a),a.querySelector(".linkoff-panel");const s=a.querySelector(".linkoff-panel-close"),d=a.querySelectorAll(".linkoff-panel-tab"),l=a.querySelectorAll(".linkoff-panel-section"),r=a.querySelectorAll("input[data-setting]"),c=a.querySelector(".linkoff-refresh-notice"),f=async n=>{const o=n.target,i=o.dataset.setting,a=o.checked;await e.set({[i]:a}),t[i]=a,c.classList.add("show"),console.log(`[LinkOff] Setting "${i}" changed to ${a}`)},m=async()=>{await(async()=>{const n=Object.keys(ae).filter(e=>"boolean"==typeof ae[e]),o=await e.get(n);t={...ae,...o},r.forEach(e=>{const n=e.dataset.setting;e.checked=t[n]??ae[n]})})(),a.classList.add("open")},h=()=>{a.classList.remove("open")};return i.addEventListener("click",m),s.addEventListener("click",h),a.addEventListener("click",e=>{e.target===a&&h()}),d.forEach(e=>{e.addEventListener("click",()=>{return n=e.dataset.tab,d.forEach(e=>e.classList.toggle("active",e.dataset.tab===n)),void l.forEach(e=>e.classList.toggle("active",e.dataset.section===n));var n})}),r.forEach(e=>{e.addEventListener("change",f)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&a.classList.contains("open")&&h()}),{open:m,close:h,destroy:()=>{o.remove(),i.remove(),a.remove()}}}!function(){(()=>{const e=document.createElement("style");e.textContent='\n    /* Hide mode */\n    .hide[class] {\n      display: none !important;\n    }\n\n    /* Dim mode */\n    .dim:not(:hover) {\n      box-shadow: none;\n    }\n\n    .dim:not(:hover) > * {\n      opacity: 0.05 !important;\n      filter: alpha(opacity=5);\n    }\n\n    /* Show forbidden icon when dimmed */\n    .dim.showIcon:not(:hover)::after {\n      content: \'\';\n      position: absolute;\n      z-index: 1;\n      width: 30px;\n      height: 30px;\n      background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="red"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/></svg>\');\n      background-size: contain;\n      background-repeat: no-repeat;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n    }\n\n    /* On hover, increase opacity to 50% */\n    .dim:hover > * {\n      opacity: 0.5;\n      filter: alpha(opacity=50);\n    }\n\n    /* Wide mode */\n    .wide-mode {\n      margin-left: 0rem !important;\n      margin-right: 0rem !important;\n      padding-left: 2rem !important;\n      padding-right: 2rem !important;\n      width: 100% !important;\n    }\n  ',document.head.appendChild(e)})(),(()=>{for(const[e,n]of Object.entries(ae))if("boolean"==typeof n){const t=se[e]||e;GM_registerMenuCommand(`Toggle: ${t}`,async()=>{const o=GM_getValue(e,n);GM_setValue(e,!o),alert(`LinkOff: ${t} is now ${o?"OFF":"ON"}\n\nRefresh the page to apply changes.`)})}GM_registerMenuCommand("Reset all settings to defaults",()=>{if(confirm("Reset all LinkOff settings to defaults?")){for(const[e,n]of Object.entries(ae))GM_setValue(e,n);alert("Settings reset. Refresh the page to apply changes.")}}),GM_registerMenuCommand("About LinkOff",()=>{alert("LinkOff - LinkedIn Filter and Customizer\n\nBy Noah Jelich\nhttps://github.com/njelich/LinkOff\n\nUse the menu commands above to toggle settings.\nRefresh the page after changing settings.")})})(),async function(e,n={}){const{onMessage:t}=n,o=async()=>{const n=Object.keys(ae),t=await e.get(n),o={...ae,...t};le(o)};e.onChanged(e=>{o()}),t&&t(async e=>{if(e["unfollow-all"]){if(!window.location.href.includes("/mynetwork/network-manager/people-follow"))return void alert("No messages. Are you on the follows page (/mynetwork/network-manager/people-follow)?\n\nIf not, please navigate to following using the LinkedIn navbar and then click the Unfollow All button again.");await z()}});let i=window.location.href;setInterval(()=>{window.location.href!==i&&(i=window.location.href,de={},o(),window.location.href.includes("/messaging/")&&b())},500),"loading"!==document.readyState?(o(),window.location.href.includes("/messaging/")&&b()):document.addEventListener("DOMContentLoaded",()=>{o(),window.location.href.includes("/messaging/")&&b()})}(re);const e=me(re);GM_registerMenuCommand("Open Settings Panel",()=>{e.open()})}()}();
